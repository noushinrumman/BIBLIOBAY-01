<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
<title>User Management | BiblioBay Admin</title>
<style>
:root {
  --primary-color: #4caf50;
  --secondary-color: #93987c;
  --accent-color: #385b64;
  --light-bg: #f8f9fa;
  --sidebar-width: 250px;
}
body { font-family: 'Poppins', sans-serif; background-color: var(--light-bg); }
.sidebar { position: fixed; top:0; left:0; height:100vh; width:var(--sidebar-width); background-color: var(--accent-color); padding-top:20px; z-index:1000; transition:all 0.3s;}
.sidebar-header { text-align:center; padding:0 15px 20px; border-bottom:1px solid rgba(255,255,255,0.1);}
.sidebar-header h3 { color:white; margin:10px 0 0; font-weight:600;}
.sidebar-menu { padding:20px 0;}
.sidebar-menu .nav-link { color: rgba(255,255,255,0.8); padding:12px 20px; display:flex; align-items:center; transition:all 0.3s;}
.sidebar-menu .nav-link:hover { color:white; background-color: rgba(255,255,255,0.1);}
.sidebar-menu .nav-link.active { color:white; background-color: rgba(255,255,255,0.2); border-left:3px solid white;}
.sidebar-menu .nav-link i { margin-right:10px; width:20px; text-align:center;}
.content { margin-left: var(--sidebar-width); padding:20px; transition:all 0.3s;}
.topbar { background-color:white; padding:15px 20px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.05); margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;}
.page-header { background-color:white; border-radius:8px; padding:20px; box-shadow:0 2px 10px rgba(0,0,0,0.05); margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;}
.users-table { background-color:white; border-radius:8px; padding:20px; box-shadow:0 2px 10px rgba(0,0,0,0.05);}
.user-avatar { width:40px; height:40px; border-radius:50%; object-fit:cover;}
.toggle-sidebar { display:none; background:none; border:none; font-size:20px; color:var(--accent-color);}
.action-buttons .btn { margin-right:5px;}
.user-status { width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:5px;}
.status-active { background-color:#28a745;}
.status-inactive { background-color:#dc3545;}
@media (max-width:768px) { .sidebar { margin-left:-250px;} .sidebar.active { margin-left:0;} .content { margin-left:0;} .toggle-sidebar { display:block;} .page-header { flex-direction:column; align-items:flex-start;} .page-header .btn { margin-top:10px; width:100%;}}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <i class="fas fa-book fa-2x text-white"></i>
    <h3>BiblioBay Admin</h3>
  </div>
  <div class="sidebar-menu">
    <nav class="nav flex-column">
      <a class="nav-link" href="admin-dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a class="nav-link" href="admin-books.html"><i class="fas fa-book"></i> Books</a>
      <a class="nav-link active" href="admin-users.html"><i class="fas fa-users"></i> Users</a>
      <a class="nav-link" href="admin-orders.html"><i class="fas fa-shopping-cart"></i> Orders</a>
      <a class="nav-link" href="admin-blogs.html"><i class="fas fa-blog"></i> Blogs</a>
      <a class="nav-link" href="admin-reviews.html"><i class="fas fa-star"></i> Reviews</a>
      <a class="nav-link" href="admin-settings.html"><i class="fas fa-cog"></i> Settings</a>
      <a class="nav-link" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </div>
</div>

<!-- Main Content -->
<div class="content">
  <div class="topbar">
    <div>
      <button class="toggle-sidebar" id="toggleSidebar"><i class="fas fa-bars"></i></button>
    </div>
    <div>
      <span class="me-3">Welcome, Admin</span>
      <a href="./index.html" class="btn btn-sm btn-outline-secondary"><i class="fas fa-external-link-alt"></i> View Site</a>
    </div>
  </div>

  <div class="page-header">
    <div>
      <h2>User Management</h2>
      <p class="text-muted mb-0">Manage registered users and their information</p>
    </div>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal"><i class="fas fa-user-plus"></i> Add New User</button>
  </div>

  <!-- Users Table -->
  <div class="users-table">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>All Users</h3>
      <div class="d-flex">
        <input type="text" class="form-control me-2" placeholder="Search users..." id="searchUsers">
        <select class="form-select" id="roleFilter">
          <option value="">All Roles</option>
          <option value="customer">Customer</option>
          <option value="member">Member</option>
          <option value="admin">Admin</option>
        </select>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>Avatar</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Joined</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <!-- Users will be populated here dynamically -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="addUserForm">
          <div class="mb-3"><label class="form-label">Full Name</label><input type="text" class="form-control" id="userName" required></div>
          <div class="mb-3"><label class="form-label">Email</label><input type="email" class="form-control" id="userEmail" required></div>
          <div class="mb-3"><label class="form-label">Password</label><input type="password" class="form-control" id="userPassword" required></div>
          <div class="mb-3"><label class="form-label">Role</label>
            <select class="form-select" id="userRole" required>
              <option value="">Select Role</option>
              <option value="customer">Customer</option>
              <option value="member">Member</option>
              <option value="admin">Admin</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" id="saveUserBtn">Save User</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit User</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="editUserForm">
          <input type="hidden" id="editUserId">
          <div class="mb-3"><label class="form-label">Full Name</label><input type="text" class="form-control" id="editUserName" required></div>
          <div class="mb-3"><label class="form-label">Email</label><input type="email" class="form-control" id="editUserEmail" required></div>
          <div class="mb-3"><label class="form-label">Role</label>
            <select class="form-select" id="editUserRole" required>
              <option value="">Select Role</option>
              <option value="customer">Customer</option>
              <option value="member">Member</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="mb-3"><label class="form-label">Status</label>
            <select class="form-select" id="editUserStatus" required>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" id="updateUserBtn">Update User</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Sidebar toggle
document.getElementById('toggleSidebar').addEventListener('click', function() {
  document.getElementById('sidebar').classList.toggle('active');
});
// Logout
document.getElementById('logoutBtn').addEventListener('click', function(e) {
  e.preventDefault();
  localStorage.removeItem('adminLoggedIn');
  window.location.href = 'admin-login.html';
});
// Check admin login
window.addEventListener('DOMContentLoaded', function() {
  if (localStorage.getItem('adminLoggedIn') !== 'true') {
    window.location.href = 'admin-login.html';
  }
});

// ------------------ LocalStorage User Management ------------------
let users = JSON.parse(localStorage.getItem('users')) || [];

// Populate table
function renderUsersTable() {
  const tbody = document.getElementById('usersTableBody');
  tbody.innerHTML = '';
  users.forEach((user, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${index+1}</td>
      <td><img src="https://picsum.photos/seed/${user.email}/40/40.jpg" class="user-avatar"></td>
      <td>${user.name}</td>
      <td>${user.email}</td>
      <td><span class="badge bg-${user.role==='admin'?'danger':user.role==='member'?'info':'primary'}">${user.role}</span></td>
      <td>${user.joined || new Date().toISOString().split('T')[0]}</td>
      <td><span class="user-status ${user.status==='active'?'status-active':'status-inactive'}"></span> ${user.status || 'active'}</td>
      <td class="action-buttons">
        <button class="btn btn-sm btn-outline-secondary" onclick="editUser(${index})"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-outline-danger" onclick="deleteUser(${index})"><i class="fas fa-trash"></i></button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Add user
document.getElementById('saveUserBtn').addEventListener('click', function() {
  const name = document.getElementById('userName').value.trim();
  const email = document.getElementById('userEmail').value.trim();
  const password = document.getElementById('userPassword').value.trim();
  const role = document.getElementById('userRole').value;

  if(!name || !email || !password || !role){ alert('Please fill all fields'); return; }

  users.push({name,email,password,role,status:'active',joined:new Date().toISOString().split('T')[0]});
  localStorage.setItem('users', JSON.stringify(users));
  renderUsersTable();
  bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
  document.getElementById('addUserForm').reset();
});

// Edit user
function editUser(index){
  const user = users[index];
  document.getElementById('editUserId').value = index;
  document.getElementById('editUserName').value = user.name;
  document.getElementById('editUserEmail').value = user.email;
  document.getElementById('editUserRole').value = user.role;
  document.getElementById('editUserStatus').value = user.status || 'active';
  new bootstrap.Modal(document.getElementById('editUserModal')).show();
}

// Update user
document.getElementById('updateUserBtn').addEventListener('click', function(){
  const index = document.getElementById('editUserId').value;
  users[index].name = document.getElementById('editUserName').value.trim();
  users[index].email = document.getElementById('editUserEmail').value.trim();
  users[index].role = document.getElementById('editUserRole').value;
  users[index].status = document.getElementById('editUserStatus').value;
  localStorage.setItem('users', JSON.stringify(users));
  renderUsersTable();
  bootstrap.Modal.getInstance(document.getElementById('editUserModal')).hide();
});

// Delete user
function deleteUser(index){
  if(confirm('Are you sure to delete this user?')){
    users.splice(index,1);
    localStorage.setItem('users', JSON.stringify(users));
    renderUsersTable();
  }
}

// Search
document.getElementById('searchUsers').addEventListener('input', function(){
  const term = this.value.toLowerCase();
  document.querySelectorAll('#usersTableBody tr').forEach((tr) => {
    tr.style.display = tr.textContent.toLowerCase().includes(term)?'':'none';
  });
});

// Filter role
document.getElementById('roleFilter').addEventListener('change', function(){
  const role = this.value.toLowerCase();
  document.querySelectorAll('#usersTableBody tr').forEach((tr) => {
    if(!role) tr.style.display='';
    else tr.style.display = tr.cells[4].textContent.toLowerCase().includes(role)?'':'none';
  });
});

// Initial render
renderUsersTable();
</script>

</body>
</html>
